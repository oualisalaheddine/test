<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Détails de l'Utilisateur</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .details-container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .user-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem 0; margin-bottom: 2rem; border-radius: 8px; }
        .info-section { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .info-section h5 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        .user-avatar { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(45deg, #007bff, #0056b3); display: flex; align-items: center; justify-content: center; color: white; font-size: 2.5rem; font-weight: bold; margin: 0 auto 20px; }
        .info-row { display: flex; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; }
        .info-label { font-weight: bold; width: 200px; color: #495057; }
        .info-value { flex: 1; }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.9em; font-weight: bold; }
        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .role-badge { background: #007bff; color: white; padding: 4px 8px; border-radius: 4px; margin: 2px; display: inline-block; }
        .activity-item { border-left: 3px solid #007bff; padding-left: 15px; margin-bottom: 10px; }
        .activity-success { border-left-color: #28a745; }
        .activity-error { border-left-color: #dc3545; }
    </style>
</head>
<body>
    <div class="details-container">
        <!-- Header -->
        <div class="user-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="mb-0"><i class="fas fa-user me-3"></i>Détails de l'Utilisateur</h1>
                        <p class="mb-0 mt-2">Informations complètes du compte utilisateur</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <a th:href="@{/securite/utilisateurs}" class="btn btn-light">
                            <i class="fas fa-arrow-left me-2"></i>Retour à la liste
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Avatar et informations principales -->
        <div class="info-section text-center">
            <div class="user-avatar" th:text="${#strings.substring(utilisateur.nom, 0, 1) + #strings.substring(utilisateur.prenom, 0, 1)}"></div>
            <h2 th:text="${utilisateur.nom + ' ' + utilisateur.prenom}">Nom de l'utilisateur</h2>
            <p class="text-muted" th:text="'@' + ${utilisateur.username}"></p>
            <span th:if="${utilisateur.compteActif}" class="status-badge status-active">
                <i class="fas fa-check-circle me-1"></i>Compte Actif
            </span>
            <span th:unless="${utilisateur.compteActif}" class="status-badge status-inactive">
                <i class="fas fa-times-circle me-1"></i>Compte Inactif
            </span>
        </div>

        <!-- Informations générales -->
        <div class="info-section">
            <h5><i class="fas fa-id-card me-2"></i>Informations Générales</h5>
            
            <div class="info-row">
                <div class="info-label">ID Utilisateur:</div>
                <div class="info-value">
                    <span class="badge bg-secondary" th:text="${utilisateur.id}"></span>
                </div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Nom d'utilisateur:</div>
                <div class="info-value">
                    <i class="fas fa-at me-2 text-muted"></i>
                    <strong th:text="${utilisateur.username}"></strong>
                </div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Email:</div>
                <div class="info-value">
                    <i class="fas fa-envelope me-2 text-muted"></i>
                    <a th:href="'mailto:' + ${utilisateur.email}" th:text="${utilisateur.email}"></a>
                </div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Date de création:</div>
                <div class="info-value">
                    <i class="fas fa-calendar me-2 text-muted"></i>
                    <span th:text="${#temporals.format(utilisateur.dateCreation, 'dd/MM/yyyy à HH:mm')}"></span>
                </div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Dernière connexion:</div>
                <div class="info-value">
                    <i class="fas fa-sign-in-alt me-2 text-muted"></i>
                    <span th:text="${utilisateur.derniereConnexion != null ? #temporals.format(utilisateur.derniereConnexion, 'dd/MM/yyyy à HH:mm') : 'Jamais connecté'}"></span>
                </div>
            </div>
        </div>

        <!-- Statut du compte -->
        <div class="info-section">
            <h5><i class="fas fa-shield-alt me-2"></i>Statut du Compte</h5>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="info-row">
                        <div class="info-label">Compte actif:</div>
                        <div class="info-value">
                            <span th:if="${utilisateur.compteActif}" class="badge bg-success">
                                <i class="fas fa-check me-1"></i>Oui
                            </span>
                            <span th:unless="${utilisateur.compteActif}" class="badge bg-danger">
                                <i class="fas fa-times me-1"></i>Non
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="info-row">
                        <div class="info-label">Compte non expiré:</div>
                        <div class="info-value">
                            <span th:if="${utilisateur.compteNonExpire}" class="badge bg-success">
                                <i class="fas fa-check me-1"></i>Oui
                            </span>
                            <span th:unless="${utilisateur.compteNonExpire}" class="badge bg-warning">
                                <i class="fas fa-exclamation me-1"></i>Non
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="info-row">
                        <div class="info-label">Identifiants non expirés:</div>
                        <div class="info-value">
                            <span th:if="${utilisateur.credentialsNonExpire}" class="badge bg-success">
                                <i class="fas fa-check me-1"></i>Oui
                            </span>
                            <span th:unless="${utilisateur.credentialsNonExpire}" class="badge bg-warning">
                                <i class="fas fa-exclamation me-1"></i>Non
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="info-row">
                        <div class="info-label">Compte non verrouillé:</div>
                        <div class="info-value">
                            <span th:if="${utilisateur.compteNonVerrouille}" class="badge bg-success">
                                <i class="fas fa-check me-1"></i>Oui
                            </span>
                            <span th:unless="${utilisateur.compteNonVerrouille}" class="badge bg-danger">
                                <i class="fas fa-lock me-1"></i>Non
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rôles assignés -->
        <div class="info-section">
            <h5><i class="fas fa-key me-2"></i>Rôles Assignés</h5>
            
            <div th:if="${roles != null and !roles.empty}">
                <div th:each="role : ${roles}" class="role-badge" th:text="${role.nom}"></div>
                <div class="mt-3">
                    <a th:href="@{'/securite/utilisateurs/' + ${utilisateur.id} + '/roles'}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-edit me-1"></i>Modifier les rôles
                    </a>
                </div>
            </div>
            <div th:if="${roles == null or roles.empty}" class="text-center text-muted py-3">
                <i class="fas fa-key fa-2x mb-2"></i>
                <p>Aucun rôle assigné à cet utilisateur.</p>
                <a th:href="@{'/securite/utilisateurs/' + ${utilisateur.id} + '/roles'}" class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i>Assigner des rôles
                </a>
            </div>
        </div>

        <!-- Actions -->
        <div class="info-section">
            <h5><i class="fas fa-cogs me-2"></i>Actions</h5>
            
            <div class="d-flex flex-wrap gap-2">
                <a th:href="@{'/securite/utilisateurs/' + ${utilisateur.id} + '/modifier'}" class="btn btn-warning">
                    <i class="fas fa-edit me-2"></i>Modifier
                </a>
                <a th:href="@{'/securite/utilisateurs/' + ${utilisateur.id} + '/roles'}" class="btn btn-info">
                    <i class="fas fa-key me-2"></i>Gérer les Rôles
                </a>
                
                <form th:action="@{'/securite/utilisateurs/' + ${utilisateur.id} + '/activer'}" method="post" style="display:inline-block;" th:if="${!utilisateur.compteActif}">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check me-2"></i>Activer
                    </button>
                </form>
                
                <form th:action="@{'/securite/utilisateurs/' + ${utilisateur.id} + '/desactiver'}" method="post" style="display:inline-block;" th:if="${utilisateur.compteActif}">
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-pause me-2"></i>Désactiver
                    </button>
                </form>
                
                <form th:action="@{'/securite/utilisateurs/' + ${utilisateur.id} + '/supprimer'}" method="post" style="display:inline-block;">
                    <button type="submit" class="btn btn-danger" 
                            onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible.')">
                        <i class="fas fa-trash me-2"></i>Supprimer
                    </button>
                </form>
            </div>
        </div>

        <!-- Navigation -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="d-flex justify-content-between">
                    <a th:href="@{/securite/utilisateurs}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Retour à la liste
                    </a>
                    <div>
                        <a th:href="@{/securite/roles}" class="btn btn-outline-primary">
                            <i class="fas fa-key me-2"></i>Gérer les Rôles
                        </a>
                        <a th:href="@{/securite/permissions}" class="btn btn-outline-success">
                            <i class="fas fa-shield-alt me-2"></i>Gérer les Permissions
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>